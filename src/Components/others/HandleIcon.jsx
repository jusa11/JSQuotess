import { useSelector, useDispatch } from 'react-redux';
import { gsap } from 'gsap';
import { IoCopyOutline } from 'react-icons/io5';
import useHandleLike from '../../Hooks/useHandleLike.js';
import { selectLikedQuotes } from '../redux/slices/likedQuotesSlice.js';
import { setSuccess } from '../redux/slices/notificationsSlice.js';

const HandleIcon = ({ quote }) => {
  const handleLike = useHandleLike();
  const likedQuotes = useSelector(selectLikedQuotes);
  const foundQuote = likedQuotes.find((q) => q._id === quote._id);
  const isLiked = foundQuote ? foundQuote.isLiked : quote.isLiked;
  const likes = foundQuote ? foundQuote.likes : quote.likes;

  const dispatch = useDispatch();
  const handleCopy = () => {
    navigator.clipboard.writeText(quote.text);
    dispatch(setSuccess('Цитата скопирована'));
  };

  const iconAnimation = (e) => {
    gsap.fromTo(
      e,
      { scale: 0.8, opacity: 0 },
      {
        opacity: 1,
        scale: 1,
        duration: 1,
        ease: 'power2.out',
      }
    );
  };

  return (
    <div className="quotes-block__card_handler">
      <div className="card-handler">
        <div className="handler-icon">
          {isLiked ? (
            <svg
              onClick={(e) => {
                handleLike(quote._id);
                iconAnimation(e.currentTarget.children[0]);
              }}
              width="22"
              height="22"
              viewBox="0 0 24 22"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M23.6247 10.7115C23.4066 11.4345 23.0868 12.1181 22.6763 12.739C22.2598 13.3807 21.7585 13.955 21.1878 14.4439L12.7576 21.7053C12.5435 21.8964 12.2729 22.0007 11.9936 22C11.7183 21.9955 11.4521 21.8944 11.2362 21.7123L2.80596 14.4509C1.6652 13.4848 0.817489 12.1816 0.36909 10.7044C-0.0783428 9.20006 -0.119833 7.592 0.249319 6.0637C0.618471 4.5354 1.38341 3.14839 2.4569 2.06088C3.44844 1.06274 4.69043 0.392299 6.03239 0.130799C7.37436 -0.130701 8.75873 0.0279539 10.0178 0.587544C10.7798 0.938476 11.4558 1.47139 11.9936 2.14507C12.5296 1.46933 13.2061 0.936035 13.9694 0.587544C15.2319 0.0220178 16.6215 -0.139804 17.9688 0.121823C19.3161 0.383449 20.5628 1.05721 21.5566 2.06088C22.6279 3.15131 23.3899 4.54058 23.7555 6.07016C24.1212 7.59973 24.0759 9.20801 23.6247 10.7115Z"
                fill="#F05161"
              />
            </svg>
          ) : (
            <svg
              onClick={(e) => {
                handleLike(quote._id);
                iconAnimation(e.currentTarget.children[0]);
              }}
              width="22"
              height="22"
              viewBox="0 0 33 28"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
            >
              <path
                fill="#c9c9c9"
                d="M27.4808 1.3C26.1386 0.455879 24.5864 0.00546285 23.0008 0C21.6316 0.0166014 20.2854 0.353569 19.0698 0.983917C17.8543 1.61427 16.8032 2.52048 16.0008 3.63C15.1984 2.52048 14.1473 1.61427 12.9318 0.983917C11.7162 0.353569 10.37 0.0166014 9.00081 0C7.415 0.00384876 5.86235 0.454392 4.5208 1.3C2.41546 2.70481 0.91026 4.84485 0.299884 7.30114C-0.310491 9.75744 0.0179225 12.3531 1.22081 14.58C3.22081 18.37 11.8108 24.96 14.9008 27.26C15.2234 27.5029 15.617 27.6329 16.0208 27.63C16.4242 27.63 16.8168 27.5003 17.1408 27.26C20.2308 24.96 28.7808 18.37 30.8108 14.58C32.0108 12.3497 32.3346 9.75151 31.7186 7.29487C31.1026 4.83823 29.5912 2.70024 27.4808 1.3ZM29.4808 13.93C27.9608 16.77 21.6308 22.09 16.2208 26.13C16.1482 26.1827 16.0606 26.2107 15.9708 26.21C15.8807 26.213 15.7924 26.1848 15.7208 26.13C10.3008 22.13 3.9708 16.77 2.4608 13.93C1.42747 12.0301 1.13973 9.81311 1.65383 7.71236C2.16792 5.6116 3.44689 3.77804 5.2408 2.57C6.35165 1.86905 7.63731 1.49479 8.95081 1.49C10.0932 1.49454 11.2183 1.76858 12.2349 2.28987C13.2514 2.81115 14.1305 3.56496 14.8008 4.49L15.9708 6.05L17.1308 4.49C17.8032 3.56477 18.6842 2.81099 19.7023 2.28977C20.7204 1.76855 21.8471 1.49456 22.9908 1.49C24.3043 1.49479 25.59 1.86905 26.7008 2.57C28.4947 3.77804 29.7737 5.6116 30.2878 7.71236C30.8019 9.81311 30.5141 12.0301 29.4808 13.93Z"
              />
            </svg>
          )}
        </div>

        <p>{likes}</p>
      </div>
      <div className="card-handler">
        <div className="handler-icon">
          <svg
            onClick={(e) => {
              iconAnimation(e.currentTarget.children[0]);
            }}
            width="19"
            height="19"
            viewBox="0 0 31 31"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
          >
            <path
              fill="#c9c9c9"
              d="M30.4164 11.8305C29.6827 8.76523 28.0273 5.99841 25.6732 3.90266C23.319 1.80691 20.3792 0.482895 17.2496 0.108934C14.12 -0.265026 10.9509 0.329025 8.16927 1.81109C5.38759 3.29315 3.12689 5.59203 1.69161 8.39813C0.256331 11.2042 -0.284598 14.3828 0.141712 17.5057C0.568022 20.6286 1.94107 23.5458 4.07595 25.8646C6.21082 28.1833 9.00498 29.7921 12.0821 30.4744C15.1592 31.1567 18.3716 30.8796 21.2864 29.6805C21.7094 29.497 22.1827 29.4652 22.6264 29.5905L26.9664 30.8305C27.1829 30.901 27.4088 30.9381 27.6364 30.9405C27.9718 30.9389 28.3027 30.8636 28.6058 30.72C28.9088 30.5764 29.1767 30.368 29.3904 30.1095C29.604 29.851 29.7583 29.5487 29.8423 29.224C29.9263 28.8994 29.9379 28.5602 29.8764 28.2305L28.9664 23.5805C28.9047 23.1521 28.9781 22.7152 29.1764 22.3305C30.8235 19.0888 31.2631 15.3667 30.4164 11.8305ZM27.5764 21.5705C27.1911 22.304 27.0609 23.1449 27.2064 23.9605L28.0864 28.6305C28.1003 28.7129 28.093 28.7976 28.065 28.8763C28.037 28.9551 27.9893 29.0254 27.9264 29.0805C27.8653 29.1396 27.7894 29.1811 27.7066 29.2005C27.6239 29.2198 27.5374 29.2164 27.4564 29.1905L23.1564 27.8305C22.833 27.7271 22.4959 27.6732 22.1564 27.6705C21.6347 27.6769 21.119 27.7821 20.6364 27.9805C17.6804 29.1872 14.3943 29.317 11.3523 28.3473C8.31028 27.3776 5.70563 25.3699 3.9933 22.6751C2.28098 19.9802 1.56984 16.7694 1.98409 13.6036C2.39834 10.4377 3.91164 7.51798 6.25969 5.35443C8.60774 3.19087 11.6413 1.92099 14.8304 1.7666C18.0195 1.61222 21.1615 2.58314 23.7076 4.50978C26.2536 6.43642 28.0419 9.1963 28.76 12.3073C29.4781 15.4184 29.0804 18.6829 27.6364 21.5305L27.5764 21.5705Z"
            />
          </svg>
        </div>
        2
      </div>
      <div className="card-handler">
        <div className="handler-icon handler-icon__share">
          <svg
            onClick={(e) => {
              iconAnimation(e.currentTarget.children[0]);
            }}
            width="18"
            height="18"
            viewBox="0 0 36 31"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
          >
            <path
              fill="#c9c9c9"
              d="M35.8592 0.490049C35.7847 0.341981 35.6704 0.217656 35.529 0.131082C35.3877 0.044509 35.2249 -0.000873613 35.0592 4.74961e-05H0.899194C0.715053 -0.00186527 0.534965 0.0540387 0.384271 0.159883C0.233577 0.265728 0.119874 0.416179 0.0591978 0.590048C-0.0065652 0.762271 -0.0178322 0.950537 0.0268797 1.12938C0.0715916 1.30823 0.170125 1.46903 0.309198 1.59005L12.3092 11.86V30.05C12.3103 30.2389 12.3708 30.4225 12.4821 30.5751C12.5933 30.7276 12.7497 30.8413 12.9292 30.9C13.022 30.9143 13.1164 30.9143 13.2092 30.9C13.3489 30.9 13.4867 30.8675 13.6117 30.805C13.7367 30.7426 13.8454 30.6518 13.9292 30.5401L35.7492 1.40005C35.8464 1.27167 35.9078 1.11978 35.9271 0.959909C35.9465 0.800036 35.923 0.637899 35.8592 0.490049ZM3.32922 1.81005H31.1292L13.3592 10.38L3.32922 1.81005ZM14.1292 12L32.1292 3.31005L14.1292 27.31V12Z"
            />
          </svg>
        </div>
      </div>
      <div className="card-handler">
        <button
          className="handler-icon_copy"
          onClick={(e) => {
            handleCopy();
            iconAnimation(e.currentTarget.children[0]);
          }}
        >
          <IoCopyOutline />
        </button>
      </div>
    </div>
  );
};

export default HandleIcon;
